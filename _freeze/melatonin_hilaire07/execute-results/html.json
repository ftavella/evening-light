{
  "hash": "f544f95327dc652ce18eb9b9f1b6be71",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: MelatoninHilaire07 model\nformat:\n  html:\n    code-fold: true\nexecute:\n  freeze: auto\nbibliography: references.bib\n---\n\n\n\nWe implemented the melatonin supression model from Hilaire et al. 2007 [@st_hilaire_physiologically_2007] on `circadian`. That paper has two main models, one with and another without a salivary melatonin component. Since a couple of the parameters for the salivary melatonin model are not specified, we only implemented the model without it. Hilaire's model however, activates melatonin for certain time-of-day values. Since the field moved away from this in favor to melatonin activation based on circadian phase [@breslow_mathematical_2013; @abeysuriya_unified_2018], we do the same here following [@breslow_mathematical_2013].\n\nThe circadian part of the model is given by `Jewett99` from `circadian` but with different parameters. The melatonin component is described by two variables:\n\n$$\n\\frac{dH_{1}}{dt} = - \\beta_{IP} H_{1} + A(t)\n$$\n\n$$\n\\frac{dH_{2}}{dt} = \\beta_{IP} H_{1} - \\beta_{CP} H_{2}\n$$\n\nwhere $H_{1}$ is the pineal melatonin and $H_{2}$ is the plasma melatonin. The function $A(t)$ is the melatonin synthesis term. On the exact definition of $A(t)$ is where [@st_hilaire_physiologically_2007] and [@breslow_mathematical_2013] differ. In the first case:\n\n$$\nA(t) = \n\\begin{cases}\n  A\\left[ \\frac{1 - e^{-\\lambda(t-t_{\\text{on}})}}{1 - e^{-\\lambda(t_{\\text{off}} - t_{\\text{on}})}} \\right] & \\text{if} \\ \\ \\ t_{\\text{on}} \\le t < t_{\\text{off}} \\\\\n  Ae^{-\\alpha(t-t_{\\text{off}})} & \\text{if} \\ \\ \\ t \\ge t_{\\text{off}}\n\\end{cases}\n$$\n\nwhere $t_{\\text{on}}$ and $t_{\\text{off}}$ are the times when melatonin synthesis starts and stops (and are determined for each subject through fitting). However, for [@breslow_mathematical_2013]:\n\n$$\nA(\\phi) = \n\\begin{cases}\n  a\\left[ \\frac{1 - e^{-\\delta M_{2\\pi}(\\phi_{\\text{on} - \\phi})}}{1 - e^{-\\delta M_{2\\pi}(\\phi_{\\text{on}} - \\phi_{\\text{off}})}} \\right] & \\text{if} \\ \\ \\ \\phi > \\phi_{\\text{on}} \\ \\ \\ \\ \\text{or} \\ \\ \\ \\ \\phi < \\phi_{\\text{off}} \\\\\n  ae^{-r M_{2\\pi}(\\phi_{\\text{on} - \\phi_{\\text{off}}})} & \\text{if} \\ \\ \\  \\phi_{\\text{on}} < \\phi < \\phi_{\\text{off}}\n\\end{cases}\n$$\n\nwhere $M_{2\\pi}$ is the modulo function. In this case, the melatonin synthesis term is activated based on the circadian phase $\\phi$ and does not have to be estimated per subject. Therefore, we use the [@breslow_mathematical_2013] version of the melatonin synthesis term. However, we need to adjust the parameters to obtain results similar to those of [@st_hilaire_physiologically_2007].\n\nThe parameters for [@st_hilaire_physiologically_2007] are:\n\n\n|   Parameter  |           Value          |\n|:------------:|:------------------------:|\n| $\\beta_{IP}$ | $4.7 \\times 10^{-2} \\ \\ \\text{min}^{-1}$ |\n| $\\beta_{CP}$ | $2.5 \\times 10^{-2} \\ \\ \\text{min}^{-1}$ |\n|   $\\alpha$   |  $6.7 \\times 10^{-2}$          |\n|   $\\lambda$  |   $5.88 \\times 10^{-1}$ |\n|      $A$     |           $4.834$          |\n\nwhile for [@breslow_mathematical_2013] are:\n\n|   Parameter  |           Value           |\n|:------------:|:-------------------------:|\n| $\\beta_{IP}$ | $7.83 \\times 10^{-4} \\ \\ \\text{sec}^{-1}$ |\n| $\\beta_{CP}$ | $3.35 \\times 10^{-4} \\ \\ \\text{sec}^{-1}$ |\n|   $\\delta$   |          $600 \\ \\ \\text{sec}$         |\n|     $r$      |          $15.36 \\ \\ \\text{sec}$        |\n|     $a$      | $1.04 \\times 10^{-3} \\ \\ \\text{sec}^{-1}$ | \n\nThe relationship between the $\\beta$ parameters is straightforward between the models. However, the relationship between the exponential factors $\\alpha$, $\\lambda$, $r$, and $\\delta$ is not. First of all it is strange that $\\delta$ and $r$ are reported with time units when they should have none (or 1/rad assuming $\\phi$ is measured in rad). The $A$  and $a$ values are more than just a scaling factor away (assuming the units for both are 1/time). Therefore, we will adjust the parameters the to obtain a result similar to the one in [@st_hilaire_physiologically_2007].\n\nThe experimental data from [@st_hilaire_physiologically_2007] shows plasma melatonin values ranging from 0 to 200 pmol/L. The activation part of the plasma melatonin curve takes about 2 hours to reach its maximum value. Similarly the cleareance part of the curve takes about 2 hours to reach its minimum value. \n\n![See last subject's behavior in Figure 2 of @st_hilaire_physiologically_2007](assets/hilaire07_fig2.png)\n\nIf we combine parameters directly (using $\\beta_{IP}$, $\\beta_{CP}$, and $A$ from [@st_hilaire_physiologically_2007] and the rest from [@breslow_mathematical_2013]) we obtain a curve that does not reproduce experimental observations:\n\n::: {#cell-direct-parameter-combination .cell execution_count=2}\n``` {.python .cell-code}\nmodel = MelatoninHilaire07(params={'a': 4.834, 'delta': 600.0, 'r': 15.36, 'betaIP': 0.047, 'betaCP': 0.025})\ntrajectory = model.integrate(time, input=light)\n\nx = trajectory.states[:, 0]\nxc = trajectory.states[:, 1]\nH1 = trajectory.states[:, 3]\nH2 = trajectory.states[:, 4]\nphase = np.arctan2(xc, x)\nfig, axs = plt.subplots(4, 1, sharex=True, figsize=(12, 8))\n# x, xc, and light\naxs[0].plot(time, x, label='x')\naxs[0].plot(time, xc, label='xc')\nlight_changes = np.diff(light)\nlight_on = np.where(light_changes > 0)[0]\nlight_off = np.where(light_changes < 0)[0]\nfor on, off in zip(light_on, light_off):\n    axs[0].axvspan(time[on], time[off], color='yellow', alpha=0.4)\naxs[0].legend()\n# phase\naxs[1].plot(time, phase, label='Phase')\naxs[1].axhline(y=model.phi_on, color='gray', linestyle='--')\naxs[1].axhline(y=model.phi_off, color='gray', linestyle='--')\nplaces_on_1 = np.where(phase < model.phi_on)\nplaces_on_2 = np.where(phase > model.phi_off)\nsynthesis_on = np.zeros_like(phase)\nsynthesis_on[places_on_1] = 1.0\nsynthesis_on[places_on_2] = 1.0\nsynthesis_changes = np.diff(synthesis_on)\non_places = np.where(synthesis_changes > 0)[0]\noff_places = np.where(synthesis_changes < 0)[0]\n# plot where it is on\nfor off, on in zip(off_places, on_places):\n    axs[1].axvspan(time[on], time[off], color='green', alpha=0.4)\n\n\n\naxs[1].legend()\n# on/off term\naxs[2].plot(time, synthesis_on, label='Melatonin synthesis on')\naxs[2].legend()\n# melatonin\naxs[3].plot(time, H1, label='Pineal melatonin')\naxs[3].plot(time, H2, label='Plasma melatonin')\naxs[3].legend()\naxs[3].set_xlabel('Time (hours)')\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![Direct combination of parameters from [@st_hilaire_physiologically_2007] and [@breslow_mathematical_2013]](melatonin_hilaire07_files/figure-html/direct-parameter-combination-output-1.png){#direct-parameter-combination width=943 height=651}\n:::\n:::\n\n\nWe can see that melatonin synthesis and cleareance are activated as expected but their rates are too slow (both for production/cleareance and for pineal-to-plasma transport). \n\n",
    "supporting": [
      "melatonin_hilaire07_files\\figure-html"
    ],
    "filters": [],
    "includes": {}
  }
}